code taken from https://github.com/dotnetjunkie/solidservices
